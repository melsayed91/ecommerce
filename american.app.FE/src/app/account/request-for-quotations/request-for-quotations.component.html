<app-navbar page="RFQs"></app-navbar>

<div class="page-content animated-500 fadeIn">
    <!-- Individual -->
    <div *ngIf="!isBusinessUser">

        <div *ngIf="rfqs?.length == 0 && !showRFQForm" class="no-rfq">
            <i class="fa fa-map-signs fa-lg"></i>
            You don't have any RFQ's published for the moment.
            <button class="btn btn-simple" (click)="showRFQForm = true">Request for quotations now!</button>
        </div>

        <div *ngIf="!rfqs && !showRFQForm" class="no-rfq">
            <i class="fa fa-location-arrow fa-xl fa-spin"></i>
            Give us a moment to fetch your RFQs..
        </div>

        <div *ngIf="showRFQForm" class="rfq-form">
            <div class="control-panel">
                <button class="btn btn-simple" (click)="showRFQForm = false">
                    <i *ngIf="!loading" class="fa fa-arrow-left"></i>&nbsp;&nbsp; Cancel
                </button>
                <button class="btn btn-simple" (click)="saveRFQ()">
                    <i *ngIf="!loading" class="fa fa-save"></i>&nbsp;&nbsp; Request for Quotation
                </button>
            </div>
            <form id="rfqForm" view-init-spy (onAfterViewInit)="formLoaded()">
                <div class="text-center">
                    <span class="required-mark"></span>Required Fields</div>
                <div class="row">
                    <div class="col-xs-12 col-md-6">
                        <div class="form-group required required">
                            <input type="text" class="form-control" name="currentRfqName" placeholder="RFQ Title" [(ngModel)]="currentRfq.title" maxlength="65"
                                data-parsley-required-message="RFQ Title is required" required>
                        </div>
                    </div>
                    <div class="col-xs-12 col-md-6">
                        <div class="form-group required">
                            <input class="form-control" id="category" name="category" placeholder="The Product Category" auto-complete [(ngModel)]="currentRfqCategory"
                                [source]="categories" [accept-user-input]="false" [no-match-found-text]="''" (valueChanged)="categoryChanged($event)"
                                (ngModelChange)="categoryChanged($event)" display-property-name="name" [list-formatter]="autocompleListFormatter"
                                data-parsley-validation-threshold="1" data-parsley-required-message="Category is required" required>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-12">
                        <div class="form-group required">
                            <textarea type="text" class="form-control" name="description" placeholder="Your Product Description" [(ngModel)]="currentRfq.description"
                                rows="3" data-parsley-required-message="Description is required" required>
                            </textarea>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-12">
                        <div class="ulpoad-area">
                            <ng2-file-input [id]="'multiFilesInput'" [show-previews]="true" [multiple]="true" (onAdded)="onAdded($event)" (onRemoved)="removeFile($event)"
                                extensions="['jpg', 'JPG', 'png', 'PNG', 'jpeg', 'JPEG']" [browse-text]="uploadIconHtml" [drop-text]="'Do you have a picture of your product? Upload it here!'">
                            </ng2-file-input>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <div *ngIf="rfqs?.length > 0 && !showRFQForm">
            <div class="control-panel">
                <button class="btn btn-simple" (click)="showRFQForm = true">Submit a new Request For Quotations!</button>
            </div>
            <div class="myrfqs">
                <div *ngFor="let rfq of rfqs" class="card card-raised">
                    <div class="card-content">
                        <h6 class="category">Published {{rfq.creationDate | amTimeAgo}}</h6>
                        <div class="icon">
                            <img src="../../../assets/img/bag.png">
                        </div>
                        <h3 class="card-title">{{rfq.title}}</h3>
                        <p class="card-description">
                            {{rfq.description}}
                        </p>
                    </div>
                    <div class="rfq-actions">
                        <button class="btn btn-simple">Received Quotations ( {{rfq.offers? rfq.offers.length: 0}} )</button>
                        <button class="btn btn-simple btn-danger btn-sm" (click)="deleteRfq(rfq.id)">Cancel RFQ</button>
                    </div>
                </div>
            </div>

        </div>

    </div>
     <!-- Business -->
     <div *ngIf="isBusinessUser">

            <div *ngIf="rfqs?.length == 0" class="no-rfq">
                <i class="fa fa-map-signs fa-xl"></i>
               There is no RFQs that match your industries...
            </div>
    
            <div *ngIf="!rfqs" class="no-rfq">
                <i class="fa fa-location-arrow fa-xl fa-spin"></i>
                Give us a moment to bring you the hottest RFQs...
            </div>
            
            <div *ngIf="rfqs?.length > 0 && !showRFQForm">
                <div class="control-panel">
                    <button class="btn btn-simple" (click)="showRFQForm = true">Submit a new Request For Quotations!</button>
                </div>
                <div class="myrfqs">
                    <div *ngFor="let rfq of rfqs" class="card card-raised">
                        <div class="card-content">
                            <h6 class="category">Published {{rfq.creationDate | amTimeAgo}}</h6>
                            <div class="icon">
                                <img *ngIf="rfq.attachments && rfq.attachments[0]" [src]="attachmentServer + rfq.attachments[0].url">
                            </div>
                            <h3 class="card-title">{{rfq.title}}</h3>
                            <p class="card-description">
                                {{rfq.description}}
                            </p>
                        </div>
                        <div class="rfq-actions">
                            <button class="btn btn-simple">Received Quotations ( {{rfq.offers? rfq.offers.length: 0}} )</button>
                            <button class="btn btn-simple btn-danger btn-sm" (click)="deleteRfq(rfq.id)">Cancel RFQ</button>
                        </div>
                    </div>
                </div>
    
            </div>
    
        </div>
</div>